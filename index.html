<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sweets & Snacks Made to Order</title>

<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fffaf4; color:#333; }
  header { background:maroon; color:white; padding:15px; text-align:center; position:relative; }
  header h1 { margin:0; }
  header p { margin:5px 0 0; font-size:14px; }
.intro {
  background: #fff8f0;
  color: #444;
  padding: 15px 20px;
  text-align: center;
  font-size: 15px;
  line-height: 1.5;
  border-bottom: 1px solid #eee;
}

/* Fixed Cart Icon */
#cart-icon { position:fixed; top:15px; right:15px; width:40px; height:40px; cursor:pointer; z-index:1000; }
#cart-icon svg { width:100%; height:100%; fill:#28a745; }
.cart-badge { position:absolute; top:-8px; right:-8px; background:gold; color:black; font-weight:bold; padding:4px 8px; border-radius:50%; font-size:14px; pointer-events:none; }

/* Products Grid */
.products { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:15px; padding:20px; }
.card { border:1px solid #ddd; border-radius:8px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); overflow:hidden; display:flex; flex-direction:column; justify-content:space-between; }
.card img { width:100%; height:150px; object-fit:cover; background:#eee; }
.card-content { padding:10px; }
.card h3 { margin:5px 0; color:maroon; }
.price-row { display:flex; align-items:center; justify-content:space-between; }
.price { font-weight:bold; margin:5px 0; }
.added-msg { color:green; font-size:14px; font-weight:bold; margin-left:10px; white-space:nowrap; }

.product-actions { display:flex; align-items:center; margin-top:5px; }
.quantity-input { width:60px; padding:5px; border:1px solid #ccc; border-radius:4px; text-align:center; margin-right:8px; }
.btn { background:maroon; color:white; border:none; padding:6px 12px; cursor:pointer; border-radius:4px; }
.btn:hover { background:#a00000; }

/* Cart & Checkout */
#cart { padding:20px; background:linear-gradient(135deg,#fff5f5,#ffe6e6,#fffaf4); }
#cart h2 { color:maroon; }
.cart-item { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #ddd; padding:8px 0; }
.cart-item input { width:50px; text-align:center; }
#checkout { padding:20px; }
#checkout h2 { color:maroon; }
label { display:block; margin-top:10px; }
input, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:4px; }

.share { margin:20px; text-align:center; }
.share button { margin:5px; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; color:white; }
.wa { background:#25D366; }
.fb { background:#4267B2; }

/* Modal */
.modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(0,0,0,0.5); }
.modal-content { background:#fff; margin:10% auto; padding:20px; border-radius:8px; width:90%; max-width:500px; }
.modal h3 { margin-top:0; color:maroon; }
.close { color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer; }
.close:hover { color:black; }
#qr-code { text-align:center; margin:15px 0; }
#receipt { background:#fffafa; padding:10px; border:1px solid #ddd; border-radius:6px; }
.upi-fallback { text-align:center; margin-top:8px; font-weight:600; }
</style>
</head>

<body>
<header>
  <h1>delights</h1>
  <p>Made fresh on order ‚Äì home made - Taste of Tradition</p>
</header>
<section id="intro" class="intro">
  <p>Welcome to <strong>delights</strong> ‚Äî your one-stop destination for homemade sweets and snacks. 
  Every item is prepared fresh on order with authentic ingredients, ensuring the taste of tradition and 
  delivered to your doorstep.</p>
</section>

<div id="cart-icon">
  <svg viewBox="0 0 24 24" width="40" height="40">
    <path fill="#28a745" d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 
    0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM7.16 14.26l.84-1.66h8.97c.75 
    0 1.41-.41 1.75-1.03l3.58-6.49-.03-.02a1 1 0 0 0-.88-.48H5.21l-.94-2H0v2h2l3.6 
    7.59-1.35 2.44c-.18.32-.25.69-.19 1.05.1.56.58.97 1.14.97h12v-2H7.16z"/>
  </svg>
  <div id="cart-badge" class="cart-badge">0</div>
</div>

<section id="products" class="products">
  <!-- Example hardcoded product cards -->
  <div class="card">
    <img src="https://raw.githubusercontent.com/talewinds/delights/refs/heads/main/images/laddu.jpg" alt="laddu">
    <div class="card-content">
      <h3>laddu</h3>
      <p>Sweet and soft laddus made from premium ingredients.</p>
      <div class="price-row">
        <span class="price">‚Çπ50 / 5 units</span>
        <span class="added-msg"></span>
      </div>
      <div class="product-actions">
        <input type="number" min="1" value="1" class="quantity-input">
        <button class="btn" onclick="addToCart('laddu', 50, parseInt(this.previousElementSibling.value))">Add</button>
      </div>
    </div>
  </div>

  <div class="card">
    <img src="https://raw.githubusercontent.com/talewinds/delights/refs/heads/main/images/mixture.jpg" alt="mixture">
    <div class="card-content">
      <h3>mixture</h3>
      <p>Crispy, savory mixture perfect for snacks.</p>
      <div class="price-row">
        <span class="price">‚Çπ40 / 100g</span>
        <span class="added-msg"></span>
      </div>
      <div class="product-actions">
        <input type="number" min="1" value="1" class="quantity-input">
        <button class="btn" onclick="addToCart('mixture', 40, parseInt(this.previousElementSibling.value))">Add</button>
      </div>
    </div>
  </div>

  <div class="card">
  <img src="https://raw.githubusercontent.com/talewinds/delights/refs/heads/main/images/mysorepak.jpg" alt="mysorepak">
  <div class="card-content">
    <h3>mysorepak</h3>
    <p>Royal sweet mysorepak which just vanishes in your mouth.</p>
    <div class="price-row">
      <span class="price">‚Çπ50 / 5 units</span>
      <span class="added-msg"></span>
    </div>
    <div class="product-actions">
      <input type="number" min="1" value="1" class="quantity-input">
      <button class="btn" onclick="addToCart('mysorepak', 50, parseInt(this.previousElementSibling.value))">Add</button>
    </div>
  </div>
</div>

  <div class="card">
  <img src="https://raw.githubusercontent.com/talewinds/delights/refs/heads/main/images/jilebi.jpg" alt="jilebi">
  <div class="card-content">
    <h3>jilebi</h3>
    <p>Golden, crispy, and juicy jilebis.</p>
    <div class="price-row">
      <span class="price">‚Çπ50 / 5 units</span>
      <span class="added-msg"></span>
    </div>
    <div class="product-actions">
      <input type="number" min="1" value="1" class="quantity-input">
      <button class="btn" onclick="addToCart('jilebi', 50, parseInt(this.previousElementSibling.value))">Add</button>
    </div>
  </div>
</div>

  <div class="card">
  <img src="https://raw.githubusercontent.com/talewinds/delights/refs/heads/main/images/pakoda.jpg" alt="pakoda">
  <div class="card-content">
    <h3>pakoda</h3>
    <p>Hot and crunchy onion pakodas which is irresistible.</p>
    <div class="price-row">
      <span class="price">‚Çπ50 / 100g</span>
      <span class="added-msg"></span>
    </div>
    <div class="product-actions">
      <input type="number" min="1" value="1" class="quantity-input">
      <button class="btn" onclick="addToCart('pakoda', 50, parseInt(this.previousElementSibling.value))">Add</button>
    </div>
  </div>
</div>

  <!-- Add more products here in the same format -->
</section>

<section id="cart">
  <h2>üõí Your Cart</h2>
  <div id="cart-items"></div>
  <p><strong>Total:</strong> ‚Çπ<span id="cart-total">0</span></p>
  <p style="font-weight:bold; color:maroon;">Please fill up your details below.</p>
</section>

<section id="checkout">
  <h2>Checkout</h2>
  <form id="checkout-form">
    <label>Name <input type="text" id="cust-name" required></label>
    <label>Phone <input type="tel" id="cust-phone" required pattern="[0-9]{10}" required></label>
    <label>Delivery Date <input type="date" id="cust-date" required></label>
    <label>Address <textarea id="cust-address" rows="3"></textarea></label>
    <button type="submit" class="btn">Confirm Order</button>
  </form>
</section>

<div class="share">
  <p>Share this menu:</p>
  <button class="wa" onclick="shareWA()">WhatsApp</button>
  <button class="fb" onclick="shareFB()">Facebook</button>
</div>

<!-- Confirmation Modal -->
<div id="confirm-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('confirm-modal')">&times;</span>
    <h3>Order Confirmation</h3>
    <div id="confirm-details"></div>
    <button class="btn" onclick="proceedPayment()">Proceed to Payment</button>
  </div>
</div>

<!-- Payment Modal -->
<div id="payment-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('payment-modal')">&times;</span>
    <h3>Pay via UPI / Gpay</h3>
    <div id="qr-code"></div>
    <p>Total Amount: ‚Çπ<span id="payment-amount"></span></p>
    <a id="upi-link" class="btn" style="display:block;text-align:center;margin-top:10px;">Pay via GPay / UPI App</a>
    <p class="upi-fallback">Or pay manually using UPI ID: <span id="upi-text" style="font-weight:700"></span></p>
    <button class="btn" onclick="generateReceipt()" style="margin-top:10px;">Click here to place Order. Payment assumed to be completed via UPI/GPay. We will confirm your payment shortly."</button>
  </div>
</div>

<!-- Receipt Modal -->
<div id="receipt-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('receipt-modal')">&times;</span>
    <h3>Your Order Receipt</h3>
    <div id="receipt"></div>
    <button class="btn" onclick="shareOrder()">Share via WhatsApp</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
const CONFIG = {
  OWNER_PHONE: "919447577561",
  UPI_ID: "lakshman.siyer-3@okaxis",
  UPI_NAME: "Lakshmanan"
};

document.getElementById("upi-text").innerText = CONFIG.UPI_ID;

let cart = [];

// Add to cart
function addToCart(name, price, qty) {
  const existing = cart.find(i => i.name === name);
  if (existing) {
    alert("Item already in cart ‚Äî edit quantity in cart");
    return true;
  } else {
    cart.push({name, price, qty});
    renderCart();
    updateCartBadge();
    return false;
  }
}

// Render cart
function renderCart() {
  const container = document.getElementById("cart-items");
  container.innerHTML = "";
  let total = 0;
  cart.forEach((item, index) => {
    total += item.price * item.qty;
    container.innerHTML += `
      <div class="cart-item">
        <span>${item.name}</span>
        <input type="number" min="1" value="${item.qty}" onchange="updateQuantity(${index}, this.value)">
        <span>‚Çπ${item.price * item.qty}</span>
        <button onclick="removeFromCart(${index})">‚ùå</button>
      </div>`;
  });
  document.getElementById("cart-total").innerText = total;
}

function updateQuantity(index, newQty) {
  cart[index].qty = parseInt(newQty) || 1;
  renderCart();
  updateCartBadge();
}
function removeFromCart(index) {
  cart.splice(index, 1);
  renderCart();
  updateCartBadge();
}

function updateCartBadge() {
  const badge = document.getElementById("cart-badge");
  badge.innerText = cart.reduce((sum, i) => sum + i.qty, 0);
}
document.getElementById("cart-icon").addEventListener("click", () => {
  document.getElementById("cart").scrollIntoView({behavior: "smooth"});
});

// Prevent past dates
const dateInput = document.getElementById("cust-date");
const today = new Date().toISOString().split("T")[0];
dateInput.setAttribute("min", today);

// Checkout submit
document.getElementById("checkout-form").addEventListener("submit", e => {
  e.preventDefault();
  const name = document.getElementById("cust-name").value;
  const phone = document.getElementById("cust-phone").value;
  const date = document.getElementById("cust-date").value;
  const address = document.getElementById("cust-address").value;
  const total = document.getElementById("cart-total").innerText;

  if (cart.length === 0) { alert("Cart is empty!"); return; }

  let detailsHTML = `<p><strong>Name:</strong> ${name}</p>`;
  detailsHTML += `<p><strong>Phone:</strong> ${phone}</p>`;
  detailsHTML += `<p><strong>Delivery Date:</strong> ${date}</p>`;
  detailsHTML += `<p><strong>Address:</strong> ${address}</p>`;
  detailsHTML += `<p><strong>Items:</strong><br>`;
  cart.forEach(i => { detailsHTML += `${i.name} x ${i.qty} @ ‚Çπ${i.price} = ‚Çπ${i.qty*i.price}<br>`; });
  detailsHTML += `</p><p><strong>Total:</strong> ‚Çπ${total}</p>`;

  document.getElementById("confirm-details").innerHTML = detailsHTML;
  openModal('confirm-modal');
});

// Confirmation ‚Üí Payment
function proceedPayment(){
  closeModal('confirm-modal');
  const totalRaw = document.getElementById("cart-total").innerText || "0";
  const totalFloat = isNaN(parseFloat(totalRaw)) ? 0 : parseFloat(totalRaw);
  document.getElementById("payment-amount").innerText = totalFloat.toFixed(2);

  const upiString = `upi://pay?pa=${encodeURIComponent(CONFIG.UPI_ID)}&pn=${encodeURIComponent(CONFIG.UPI_NAME)}&am=${encodeURIComponent(totalFloat.toFixed(2))}&cu=INR`;
  document.getElementById('qr-code').innerHTML = "";
  QRCode.toCanvas(document.getElementById('qr-code'), upiString, function (error) {
    if (error) document.getElementById('qr-code').innerText = "QR generation failed ‚Äî please use UPI ID below.";
  });
  const upiLink = document.getElementById("upi-link");
  upiLink.href = upiString;
  upiLink.setAttribute("target", "_blank");
  document.getElementById("upi-text").innerText = CONFIG.UPI_ID;
  openModal('payment-modal');
}

// Generate receipt
function generateReceipt(){
  closeModal('payment-modal');
  const name = document.getElementById("cust-name").value;
  const phone = document.getElementById("cust-phone").value;
  const date = document.getElementById("cust-date").value;
  const address = document.getElementById("cust-address").value;
  const totalRaw = document.getElementById("cart-total").innerText || "0";
  const formattedTotal = (isNaN(parseFloat(totalRaw)) ? 0 : parseFloat(totalRaw)).toFixed(2);

  let itemsText = cart.map(i => `${i.name} x ${i.qty} = ‚Çπ${(i.qty*i.price).toFixed(2)}`).join("; ");

  // Send order to Google Sheet
  const url = "https://script.google.com/macros/s/AKfycbzzzaHRIU_agcxU1tiVz6sO5LuJzfUYVcgvX6i4A_ZPTKPDZV_zFVhx7SLngXC7OSxmwg/exec" +
    `?name=${encodeURIComponent(name)}` +
    `&phone=${encodeURIComponent(phone)}` +
    `&date=${encodeURIComponent(date)}` +
    `&address=${encodeURIComponent(address)}` +
    `&items=${encodeURIComponent(itemsText)}` +
    `&total=${encodeURIComponent(formattedTotal)}`;

  fetch(url)
    .then(res => res.json())
    .then(resp => console.log("Order sent to Sheet:", resp))
    .catch(err => console.error("Failed to send order:", err));

  let receiptHTML = `<p><strong>Name:</strong> ${name}</p>`;
  receiptHTML += `<p><strong>Phone:</strong> ${phone}</p>`;
  receiptHTML += `<p><strong>Delivery Date:</strong> ${date}</p>`;
  receiptHTML += `<p><strong>Address:</strong> ${address}</p>`;
  receiptHTML += `<p><strong>Items:</strong><br>` + itemsText.replace(/;/g,"<br>") + `</p>`;
  receiptHTML += `<p><strong>Total Paid:</strong> ‚Çπ${formattedTotal}</p>`;
  receiptHTML += `<p>Paid via GPay/UPI (QR or UPI intent)</p>`;

  document.getElementById("receipt").innerHTML = receiptHTML;
  openModal('receipt-modal');

  cart = [];
  renderCart();
  updateCartBadge();
  document.getElementById("checkout-form").reset();
}

// Share order (WhatsApp)
function shareOrder(){
  const receipt = document.getElementById("receipt").innerText;
  const msg = encodeURIComponent("New Order:\n\n" + receipt);
  window.open(`https://wa.me/${CONFIG.OWNER_PHONE}?text=${msg}`, "_blank");
  closeModal('receipt-modal');
}

// Social sharing
function shareWA(){
  const url = encodeURIComponent(window.location.href);
  window.open("https://wa.me/?text=Check%20out%20this%20menu:%20" + url, "_blank");
}
function shareFB(){
  const url = encodeURIComponent(window.location.href);
  window.open("https://www.facebook.com/sharer/sharer.php?u=" + url, "_blank");
}

// Modal helpers
function openModal(id){ document.getElementById(id).style.display="block"; }
function closeModal(id){ document.getElementById(id).style.display="none"; }
</script>
</body>
</html>
