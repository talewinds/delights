<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sweets & Snacks Made to Order</title>
<style>
Â  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fffaf4; color:#333; }
Â  header { background:maroon; color:white; padding:15px; text-align:center; position:relative; }
Â  header h1 { margin:0; }
Â  header p { margin:5px 0 0; font-size:14px; }

Â  /* Fixed Cart Icon */
Â  #cart-icon { position:fixed; top:15px; right:15px; width:40px; height:40px; cursor:pointer; z-index:1000; }
Â  #cart-icon svg { width:100%; height:100%; fill:#28a745; }
Â  .cart-badge { position:absolute; top:-8px; right:-8px; background:gold; color:black; font-weight:bold; padding:4px 8px; border-radius:50%; font-size:14px; pointer-events:none; }

Â  /* Products Grid */
Â  .products { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:15px; padding:20px; }
Â  .card { border:1px solid #ddd; border-radius:8px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); overflow:hidden; display:flex; flex-direction:column; justify-content:space-between; }
Â  .card img { width:100%; height:150px; object-fit:cover; background:#eee; }
Â  .card-content { padding:10px; }
Â  .card h3 { margin:5px 0; color:maroon; }
Â  .price-row { display:flex; align-items:center; justify-content:space-between; }
Â  .price { font-weight:bold; margin:5px 0; }
Â  .added-msg { color:green; font-size:13px; margin-left:10px; white-space:nowrap; }

Â  .product-actions { display:flex; align-items:center; margin-top:5px; }
Â  .quantity-input { width:60px; padding:5px; border:1px solid #ccc; border-radius:4px; text-align:center; margin-right:8px; }
Â  .btn { background:maroon; color:white; border:none; padding:6px 12px; cursor:pointer; border-radius:4px; }
Â  .btn:hover { background:#a00000; }

Â  /* Cart & Checkout */
Â  #cart { padding:20px; background:linear-gradient(135deg,#fff5f5,#ffe6e6,#fffaf4); }
Â  #cart h2 { color:maroon; }
Â  .cart-item { display:flex; justify-content:space-between; border-bottom:1px solid #ddd; padding:8px 0; }
Â  #checkout { padding:20px; }
Â  #checkout h2 { color:maroon; }
Â  label { display:block; margin-top:10px; }
Â  input, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:4px; }

Â  .share { margin:20px; text-align:center; }
Â  .share button { margin:5px; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; color:white; }
Â  .wa { background:#25D366; }
Â  .fb { background:#4267B2; }

Â  /* Skeleton loading */
Â  .skeleton { background: linear-gradient(90deg, #eee 25%, #f5f5f5 50%, #eee 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
Â  @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

Â  /* Modal */
Â  .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; overflow:auto; background:rgba(0,0,0,0.5); }
Â  .modal-content { background:#fff; margin:10% auto; padding:20px; border-radius:8px; width:90%; max-width:500px; }
Â  .modal h3 { margin-top:0; color:maroon; }
Â  .close { color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer; }
Â  .close:hover { color:black; }
Â  #qr-code { text-align:center; margin:15px 0; }
Â  #receipt { background:#fffafa; padding:10px; border:1px solid #ddd; border-radius:6px; }
Â  .upi-fallback { text-align:center; margin-top:8px; font-weight:600; }
</style>
</head>
<body>

<header>
Â  <h1>delights</h1>
Â  <p>Made fresh on order â€“ home made - Taste of Tradition</p>
</header>

<div id="cart-icon">
Â  <svg viewBox="0 0 24 24" width="40" height="40">
Â  Â  <path fill="#28a745" d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10Â 
Â  Â  0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM7.16 14.26l.84-1.66h8.97c.75Â 
Â  Â  0 1.41-.41 1.75-1.03l3.58-6.49-.03-.02a1 1 0 0 0-.88-.48H5.21l-.94-2H0v2h2l3.6Â 
Â  Â  7.59-1.35 2.44c-.18.32-.25.69-.19 1.05.1.56.58.97 1.14.97h12v-2H7.16z"/>
Â  </svg>
Â  <div id="cart-badge" class="cart-badge">0</div>
</div>

<section id="products" class="products">
Â  <div class="card skeleton"><div style="height:150px;"></div><div class="card-content"><h3 style="height:20px;width:70%;"></h3><p style="height:15px;width:90%;"></p><p style="height:15px;width:50%;"></p><button class="btn" style="opacity:0"></button></div></div>
</section>

<section id="cart">
Â  <h2>ðŸ›’ Your Cart</h2>
Â  <div id="cart-items"></div>
Â  <p><strong>Total:</strong> â‚¹<span id="cart-total">0</span></p>
Â  <button id="proceed-confirm" class="btn">Proceed to Confirmation</button>
</section>

<section id="checkout">
Â  <h2>Checkout</h2>
Â  <form id="checkout-form">
Â  Â  <label>Name <input type="text" id="cust-name" required></label>
Â  Â  <label>Phone <input type="text" id="cust-phone" required></label>
Â  Â  <label>Delivery Date <input type="date" id="cust-date" required></label>
Â  Â  <label>Address <textarea id="cust-address"></textarea></label>
Â  Â  <p><strong>Pay Advance via GPay:</strong><br>UPI ID: <span id="upi-id"></span></p>
Â  Â  <button type="submit" class="btn">Confirm Order</button>
Â  </form>
</section>

<div class="share">
Â  <p>Share this menu:</p>
Â  <button class="wa" onclick="shareWA()">WhatsApp</button>
Â  <button class="fb" onclick="shareFB()">Facebook</button>
</div>

<div id="confirm-modal" class="modal">
Â  <div class="modal-content">
Â  Â  <span class="close" onclick="closeModal('confirm-modal')">&times;</span>
Â  Â  <h3>Order Confirmation</h3>
Â  Â  <div id="confirm-details"></div>
Â  Â  <button class="btn" onclick="proceedPayment()">Proceed to Payment</button>
Â  </div>
</div>

<div id="payment-modal" class="modal">
Â  <div class="modal-content">
Â  Â  <span class="close" onclick="closeModal('payment-modal')">&times;</span>
Â  Â  <h3>Pay via UPI / QR Code</h3>
Â  Â  <div id="qr-code"></div>
Â  Â  <p>Total Amount: â‚¹<span id="payment-amount"></span></p>

Â  Â  Â  Â  <a id="upi-link" class="btn" style="display:block;text-align:center;margin-top:10px;">Pay via GPay / UPI App</a>

Â  Â  Â  Â  <p class="upi-fallback">Or pay manually using UPI ID: <span id="upi-text" style="font-weight:700"></span></p>

Â  Â  <button class="btn" onclick="generateReceipt()" style="margin-top:10px;">I've Paid</button>
Â  </div>
</div>

<div id="receipt-modal" class="modal">
Â  <div class="modal-content">
Â  Â  <span class="close" onclick="closeModal('receipt-modal')">&times;</span>
Â  Â  <h3>Your Order Receipt</h3>
Â  Â  <div id="receipt"></div>
Â  Â  <button class="btn" onclick="shareOrder()">Share via WhatsApp</button>
Â  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
const CONFIG = {
Â  OWNER_PHONE: "919447577561",
Â  UPI_ID: "hariharmia1@okicici",
Â  SHEET_PRODUCTS_URL: "https://script.google.com/macros/s/AKfycbwJx535jhdv70wneiEj5qZSPqvOHJpP2B-t7hXK0RgaM1K7a_5uAiWz3OL6ETt1rYhwPg/exec"
};

document.getElementById("upi-id").innerText = CONFIG.UPI_ID;
document.getElementById("upi-text").innerText = CONFIG.UPI_ID;

let cart = [];

// Load products from Google Sheet (unchanged)
function loadProducts() {
Â  fetch(CONFIG.SHEET_PRODUCTS_URL)
Â  Â  .then(res => res.json())
Â  Â  .then(data => {
Â  Â  Â  const container = document.getElementById("products");
Â  Â  Â  container.innerHTML = "";
Â  Â  Â  data.forEach(item => {
Â  Â  Â  Â  const card = document.createElement("div");
Â  Â  Â  Â  card.className = "card";

Â  Â  Â  Â  const img = document.createElement("img");
Â  Â  Â  Â  img.src = item.image_url || item.image || "https://via.placeholder.com/150";
Â  Â  Â  Â  img.alt = item.name;

Â  Â  Â  Â  const content = document.createElement("div");
Â  Â  Â  Â  content.className = "card-content";

Â  Â  Â  Â  const h3 = document.createElement("h3");
Â  Â  Â  Â  h3.innerText = item.name;

Â  Â  Â  Â  const desc = document.createElement("p");
Â  Â  Â  Â  desc.innerText = item.description || item.desc || "";

Â  Â  Â  Â  const priceRow = document.createElement("div");
Â  Â  Â  Â  priceRow.className = "price-row";
Â  Â  Â  Â  const price = document.createElement("span");
Â  Â  Â  Â  price.className = "price";
Â  Â  Â  Â  price.innerText = "â‚¹" + item.price;
Â  Â  Â  Â  const addedMsg = document.createElement("span");
Â  Â  Â  Â  addedMsg.className = "added-msg";
Â  Â  Â  Â  priceRow.appendChild(price);
Â  Â  Â  Â  priceRow.appendChild(addedMsg);

Â  Â  Â  Â  const actions = document.createElement("div");
Â  Â  Â  Â  actions.className = "product-actions";

Â  Â  Â  Â  const qtyInput = document.createElement("input");
Â  Â  Â  Â  qtyInput.type = "number";
Â  Â  Â  Â  qtyInput.min = "1";
Â  Â  Â  Â  qtyInput.value = "1";
Â  Â  Â  Â  qtyInput.className = "quantity-input";

Â  Â  Â  Â  const btn = document.createElement("button");
Â  Â  Â  Â  btn.className = "btn";
Â  Â  Â  Â  btn.innerText = "Add";

Â  Â  Â  Â  btn.addEventListener("click", () => {
Â  Â  Â  Â  Â  let qty = parseInt(qtyInput.value) || 1;
Â  Â  Â  Â  Â  addToCart(item.name, Number(item.price), qty);
Â  Â  Â  Â  Â  addedMsg.innerText = `${qty} units added to cart`;
Â  Â  Â  Â  Â  setTimeout(() => { addedMsg.innerText=""; }, 1500);
Â  Â  Â  Â  });

Â  Â  Â  Â  actions.appendChild(qtyInput);
Â  Â  Â  Â  actions.appendChild(btn);

Â  Â  Â  Â  content.appendChild(h3);
Â  Â  Â  Â  content.appendChild(desc);
Â  Â  Â  Â  content.appendChild(priceRow);
Â  Â  Â  Â  content.appendChild(actions);

Â  Â  Â  Â  card.appendChild(img);
Â  Â  Â  Â  card.appendChild(content);
Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  });
Â  Â  })
Â  Â  .catch(err => console.error("Failed to load products:", err));
}

// Cart functions (unchanged)
function addToCart(name, price, qty) {
Â  const existing = cart.find(i => i.name === name);
Â  if (existing) existing.qty += qty; else cart.push({name, price, qty});
Â  renderCart(); updateCartBadge();
}
function renderCart() {
Â  const container = document.getElementById("cart-items");
Â  container.innerHTML = "";
Â  let total = 0;
Â  cart.forEach(item => {
Â  Â  total += item.price * item.qty;
Â  Â  container.innerHTML += `<div class="cart-item"><span>${item.name} x ${item.qty}</span><span>â‚¹${item.price*item.qty}</span></div>`;
Â  });
Â  document.getElementById("cart-total").innerText = total;
}
function updateCartBadge() {
Â  const badge = document.getElementById("cart-badge");
Â  badge.innerText = cart.reduce((sum, i) => sum + i.qty, 0);
}
document.getElementById("cart-icon").addEventListener("click", () => {
Â  document.getElementById("cart").scrollIntoView({behavior: "smooth"});
});

// Prevent past dates (unchanged)
const dateInput = document.getElementById("cust-date");
const today = new Date().toISOString().split("T")[0];
dateInput.setAttribute("min", today);

// Checkout form submit â†’ show confirmation modal (unchanged)
document.getElementById("checkout-form").addEventListener("submit", e => {
Â  e.preventDefault();
Â  const name = document.getElementById("cust-name").value;
Â  const phone = document.getElementById("cust-phone").value;
Â  const date = document.getElementById("cust-date").value;
Â  const address = document.getElementById("cust-address").value;
Â  const total = document.getElementById("cart-total").innerText;

Â  if (cart.length === 0) { alert("Cart is empty!"); return; }

Â  let detailsHTML = `<p><strong>Name:</strong> ${name}</p>`;
Â  detailsHTML += `<p><strong>Phone:</strong> ${phone}</p>`;
Â  detailsHTML += `<p><strong>Delivery Date:</strong> ${date}</p>`;
Â  detailsHTML += `<p><strong>Address:</strong> ${address}</p>`;
Â  detailsHTML += `<p><strong>Items:</strong><br>`;
Â  cart.forEach(i => { detailsHTML += `${i.name} x ${i.qty} @ â‚¹${i.price} = â‚¹${i.qty*i.price}<br>`; });
Â  detailsHTML += `</p><p><strong>Total:</strong> â‚¹${total}</p>`;

Â  document.getElementById("confirm-details").innerHTML = detailsHTML;
Â  openModal('confirm-modal');
});

// Confirmation â†’ Payment (FIXED: The amount formatting for the UPI intent link has been updated
// to remove trailing .00 for integer amounts to avoid "payment exceeds limit" error in some UPI apps.)
function proceedPayment(){
Â  closeModal('confirm-modal');
Â  const totalRaw = document.getElementById("cart-total").innerText || "0";
Â  const totalFloat = isNaN(parseFloat(totalRaw)) ? 0 : parseFloat(totalRaw);

Â  let amountForUpi;
Â  // Check if the amount is a whole number (integer)
Â  if (Number.isInteger(totalFloat)) {
Â  Â  // If it's a whole number, use it as a simple string without decimals
Â  Â  amountForUpi = totalFloat.toString();
Â  } else {
Â  Â  // If it has decimal places, format it to two decimal places
Â  Â  amountForUpi = totalFloat.toFixed(2);
Â  }
Â  
Â  // Display the two-decimal total in the modal for the user
Â  document.getElementById("payment-amount").innerText = totalFloat.toFixed(2);

Â  // build UPI intent using the adjusted amountForUpi
Â  const upiString = `upi://pay?pa=${encodeURIComponent(CONFIG.UPI_ID)}&pn=${encodeURIComponent('vidhyaharihar')}&mc=0000&tid=${Date.now()}&tr=${Date.now()}&tn=${encodeURIComponent('Order Payment')}&am=${encodeURIComponent(amountForUpi)}&cu=INR`;
Â  
Â  // generate QR
Â  try {
Â  Â  // Use the new upiString for QR code generation
Â  Â  QRCode.toCanvas(document.getElementById('qr-code'), upiString, function (error) {
Â  Â  Â  if (error) {
Â  Â  Â  Â  console.error("QR gen error:", error);
Â  Â  Â  Â  document.getElementById('qr-code').innerText = "QR generation failed â€” please use UPI ID below.";
Â  Â  Â  }
Â  Â  });
Â  } catch (err) {
Â  Â  console.error("QR exception:", err);
Â  Â  document.getElementById('qr-code').innerText = "QR generation failed â€” please use UPI ID below.";
Â  }

Â  // set up the UPI app link (intent). Using upi://pay should invoke installed UPI apps on mobile.
Â  const upiLink = document.getElementById("upi-link");
Â  upiLink.href = upiString;
Â  // open in same context to let mobile try to open UPI app; still works from desktop for apps that register the scheme.
Â  upiLink.setAttribute("target", "_self");

Â  // ensure manual UPI ID displayed (always present)
Â  document.getElementById("upi-text").innerText = CONFIG.UPI_ID;

Â  openModal('payment-modal');
}

// Payment â†’ Generate Receipt (unchanged besides formatting total)
function generateReceipt(){
Â  closeModal('payment-modal');
Â  const name = document.getElementById("cust-name").value;
Â  const phone = document.getElementById("cust-phone").value;
Â  const date = document.getElementById("cust-date").value;
Â  const address = document.getElementById("cust-address").value;
Â  const totalRaw = document.getElementById("cart-total").innerText || "0";
Â  const formattedTotal = (isNaN(parseFloat(totalRaw)) ? 0 : parseFloat(totalRaw)).toFixed(2);

Â  let receiptHTML = `<p><strong>Name:</strong> ${name}</p>`;
Â  receiptHTML += `<p><strong>Phone:</strong> ${phone}</p>`;
Â  receiptHTML += `<p><strong>Delivery Date:</strong> ${date}</p>`;
Â  receiptHTML += `<p><strong>Address:</strong> ${address}</p>`;
Â  receiptHTML += `<p><strong>Items:</strong><br>`;
Â  cart.forEach(i => { receiptHTML += `${i.name} x ${i.qty} @ â‚¹${i.price} = â‚¹${(i.qty*i.price).toFixed ? (i.qty*i.price).toFixed(2) : (i.qty*i.price)}<br>`; });
Â  receiptHTML += `</p><p><strong>Total Paid:</strong> â‚¹${formattedTotal}</p>`;
Â  receiptHTML += `<p>Paid via GPay/UPI (QR or UPI intent)</p>`;

Â  document.getElementById("receipt").innerHTML = receiptHTML;
Â  openModal('receipt-modal');

Â  // clear cart as before
Â  cart = [];
Â  renderCart();
Â  updateCartBadge();
Â  document.getElementById("checkout-form").reset();
}

// Share receipt via WhatsApp (unchanged)
function shareOrder(){
Â  const text = document.getElementById("receipt").innerText;
Â  const waLink = `https://wa.me/${CONFIG.OWNER_PHONE}?text=${encodeURIComponent(text)}`;
Â  window.open(waLink, "_blank");
}

// Modal helpers (unchanged)
function openModal(id){ document.getElementById(id).style.display = "block"; }
function closeModal(id){ document.getElementById(id).style.display = "none"; }

// Share menu buttons (unchanged)
function shareWA(){ window.open(`https://wa.me/?text=Check out homemade sweets & snacks! ${location.href}`,"_blank"); }
function shareFB(){ window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}`,"_blank"); }

// Proceed to Confirmation button in cart (unchanged)
document.getElementById("proceed-confirm").addEventListener("click", ()=>{
Â  document.getElementById("checkout").scrollIntoView({behavior:"smooth"});
});

// initial load
loadProducts();
</script>
</body>
</html>
